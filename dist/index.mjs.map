{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { Plugin } from \"vite\";\r\nimport path from \"path\";\r\nimport { google } from \"googleapis\";\r\nimport { loadEnv } from \"vite\";\r\n\r\ninterface Options {\r\n\tcreds: string\r\n}\r\n\r\nexport default (options: Options): Plugin => {\r\n\tconst env = loadEnv(\"\", process.cwd(), \"\");\r\n\tconst regex = new RegExp(`%sheets\\.(.+?)%`, \"g\");\r\n\tconst creds = path.join(process.cwd(), options.creds);\r\n\tconst auth = new google.auth.GoogleAuth({\r\n\t\tkeyFile: creds,\r\n\t\tscopes: \"https://www.googleapis.com/auth/spreadsheets.readonly\"\r\n\t});\r\n\r\n\r\n\treturn {\r\n\t\tname: \"vite-plugin-sheets\",\r\n\t\tasync transform(code, id) {\r\n\t\t\tconst client = await auth.getClient();\r\n\t\t\tconst sheets = google.sheets({ version: \"v4\", auth: client });\r\n\t\t\tconst { data } = await sheets.spreadsheets.values.get({\r\n\t\t\t\tauth,\r\n\t\t\t\tspreadsheetId: env.SPREADSHEET_ID,\r\n\t\t\t\trange: env.SHEET ?? \"Sheet1\"\r\n\t\t\t});\r\n\t\t\tdata.values?.shift();\r\n\t\t\tconst slots = new Map(data.values?.map(v => [v[0], v[1]]));\r\n\t\t\tconst result = { code };\r\n\t\t\tconst matches = code.matchAll(regex);\r\n\t\t\tfor (const match of matches) {\r\n\t\t\t\tif (slots.has(match[1])) {\r\n\t\t\t\t\tresult.code = result.code.replace(match[0], slots.get(match[1]));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.code = result.code.replace(match[0], `Error: ${match[1]} missing slot from sheet`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t};\r\n};\r\n"],"names":[],"mappings":";;;;AASA,YAAe,CAAC,OAAgB;IAC/B,MAAM,GAAG,GAAG,OAAO,CAAC,EAAE,EAAE,OAAO,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC;IAC3C,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC;IACjD,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;IACtD,MAAM,IAAI,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACvC,OAAO,EAAE,KAAK;QACd,MAAM,EAAE,uDAAuD;KAC/D,CAAC,CAAC;IAGH,OAAO;QACN,IAAI,EAAE,oBAAoB;QAC1B,MAAM,SAAS,CAAC,IAAI,EAAE,EAAE;;YACvB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,SAAS,EAAE,CAAC;YACtC,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YAC9D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;gBACrD,IAAI;gBACJ,aAAa,EAAE,GAAG,CAAC,cAAc;gBACjC,KAAK,EAAE,MAAA,GAAG,CAAC,KAAK,mCAAI,QAAQ;aAC5B,CAAC,CAAC;YACH,MAAA,IAAI,CAAC,MAAM,0CAAE,KAAK,EAAE,CAAC;YACrB,MAAM,KAAK,GAAG,IAAI,GAAG,CAAC,MAAA,IAAI,CAAC,MAAM,0CAAE,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC3D,MAAM,MAAM,GAAG,EAAE,IAAI,EAAE,CAAC;YACxB,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACrC,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;gBAC5B,IAAI,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;oBACxB,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;iBACjE;qBAAM;oBACN,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,KAAK,CAAC,CAAC,CAAC,0BAA0B,CAAC,CAAC;iBAC1F;aACD;YAED,OAAO,MAAM,CAAC;SACd;KACD,CAAC;AACH,CAAC;;;;"}